-- =====================================================
-- Задача: Анализ активных клиентов за последнюю неделю
-- Тема: Динамические временные интервалы с подзапросами
-- Цель: Рассчитать количество уникальных клиентов, сделавших хотя бы один заказ за последнюю неделю

-- Используемые операторы:
-- Подзапрос в WHERE - динамическое вычисление временной границы
-- MAX() - нахождение последней даты в dataset
-- INTERVAL '1 week' - временной интервал для расчета периода
-- COUNT(DISTINCT) - подсчет уникальных пользователей
-- =====================================================

SELECT 
  COUNT(DISTINCT user_id) AS users_count 
FROM 
  user_actions 
WHERE 
  action = 'create_order' 
  AND time >= (
    SELECT 
      MAX(time) - INTERVAL '1 week' 
    FROM 
      user_actions
  )
