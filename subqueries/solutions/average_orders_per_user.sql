-- =====================================================
-- Задача: Расчет среднего количества заказов на пользователя
-- Тема: Подзапросы в FROM
-- Цель: Рассчитать среднее арифметическое количество заказов по всем пользователям сервиса

-- Используемые операторы:
-- Подзапрос в FROM (derived table) - создание временной таблицы с агрегацией по пользователям
-- COUNT() - подсчет заказов для каждого пользователя
-- AVG() - расчет среднего значения по всем пользователям
-- ROUND() - округление результата до двух знаков после запятой
-- GROUP BY - группировка по пользователям в подзапросе
-- =====================================================

SELECT 
  ROUND(
    AVG(order_count), 
    2
  ) AS orders_avg 
FROM 
  (
    SELECT 
      user_id, 
      COUNT(order_id) AS order_count 
    FROM 
      user_actions 
    WHERE 
      action = 'create_order' 
    GROUP BY 
      user_id
  ) AS subquery
