-- =====================================================
-- Задача: Расчет возраста самого молодого курьера-мужчины на дату последней активности
-- Тема: Сложные вложенные подзапросы с функциями дат
-- Курс: SQL для аналитики данных
-- Дата: 2024-01-15
-- Автор: [Твое имя]
-- =====================================================

-- Цель: Найти возраст самого молодого курьера мужского пола на момент последней зафиксированной активности в системе
-- Бизнес-контекст: Анализ возрастного состава курьеров, проверка соответствия возрастным требованиям, планирование кадровой политики

-- Используемые операторы:
-- Вложенный скалярный подзапрос в функции AGE()
-- MAX() с приведением типа ::DATE для получения даты
-- AGE() с динамической датой отсчета из подзапроса
-- MIN() для нахождения минимального возраста
-- Приведение типа ::VARCHAR для текстового формата результата
SELECT 
  MIN(
    AGE(
      (
        SELECT 
          MAX(time):: DATE 
        FROM 
          courier_actions
      ), 
      birth_date
    )
  ):: VARCHAR AS min_age 
FROM 
  couriers 
WHERE 
  sex = 'male'
