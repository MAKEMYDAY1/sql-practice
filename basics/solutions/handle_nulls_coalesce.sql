-- =====================================================
-- Задача: Обработка NULL значений в датах рождения
-- Цель: Заменить NULL значения в годе рождения на 'unknown' с помощью COALESCE

-- Используемые функции:
-- COALESCE() - возвращает первое не-NULL значение
-- DATE_PART() - извлечение года из даты
-- CAST() - преобразование типов данных
-- =====================================================

SELECT 
  courier_id, 
  COALESCE(
    CAST(
      DATE_PART('year', birth_date) AS VARCHAR
    ), 
    'unknown'
  ) AS birth_year 
FROM 
  couriers 
ORDER BY 
  birth_year DESC, 
  courier_id

-- Логика решения:
-- 1. DATE_PART('year', birth_date) - извлекает год из даты (может вернуть NULL)
-- 2. CAST(... AS VARCHAR) - преобразует числовой год в строку для единого типа данных
-- 3. COALESCE(..., 'unknown') - подставляет 'unknown' если год равен NULL
-- 4. Сортировка работает с mixed типами: числа как строки + текстовые значения

-- Пример результата:
-- courier_id | birth_year
-- 105        | 1998
-- 102        | 1998  
-- 107        | 1995
-- 101        | unknown

-- Примечание: CAST необходим потому что COALESCE требует одинаковых типов данных
-- в своих аргументах (нельзя смешивать INTEGER и TEXT напрямую)