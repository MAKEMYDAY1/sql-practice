-- =====================================================
-- Задача: Расчет НДС и цены без налога
-- Цель: Разделить цену товара на сумму НДС и цену без налога

-- Используемые функции:
-- ROUND() - округление финансовых показателей
-- =====================================================

SELECT 
  product_id, 
  name, 
  price, 
  ROUND(price / 120 * 20, 2) AS tax, 
  ROUND(
    price - (price / 120 * 20), 
    2
  ) AS price_before_tax 
FROM 
  products 
ORDER BY 
  price_before_tax DESC, 
  product_id

-- Логика решения:
-- 1. price / 120 * 20 - расчет суммы НДС (20% от цены с учетом налога)
-- 2. price - tax - расчет цены без учета НДС
-- 3. ROUND(..., 2) - округление до копеек для финансовой точности

-- Математическая формула:
-- Цена с НДС = Цена без НДС + НДС
-- НДС = Цена с НДС × (Ставка НДС / (100 + Ставка НДС))
-- Для ставки 20%: НДС = Цена × (20 / 120)

-- Пример расчета для товара ценой 120 руб:
-- НДС = 120 × (20 / 120) = 20 руб
-- Цена без НДС = 120 - 20 = 100 руб

-- Пример результата:
-- product_id | name           | price  | tax  | price_before_tax
-- 105        | iPhone 15 Pro  | 1200.00| 200.00| 1000.00
-- 102        | MacBook Pro    | 1440.00| 240.00| 1200.00
-- 107        | AirPods Pro    | 240.00 | 40.00 | 200.00