-- =====================================================
-- Задача: Анализ среднего размера заказов по выходным дням
-- Тема: Агрегация данных в SQL
-- Цель: Рассчитать среднее количество товаров в заказах, оформленных в субботу и воскресенье

-- Используемые функции:
-- DATE_PART() - извлечение дня недели из временной метки
-- ARRAY_LENGTH() - подсчет количества товаров в массиве
-- AVG() - расчет среднего значения
-- ROUND() - округление результата
-- =====================================================

SELECT 
    ROUND(AVG(ARRAY_LENGTH(product_ids, 1)), 2) AS avg_order_size 
FROM orders 
WHERE 
    DATE_PART('dow', creation_time) = 6     -- Суббота
    OR DATE_PART('dow', creation_time) = 0; -- Воскресенье

-- Логика решения:
-- 1. DATE_PART('dow', creation_time) - извлекает день недели из даты создания заказа
--    • В PostgreSQL: 0=воскресенье, 1=понедельник, ..., 6=суббота
-- 2. Фильтрация заказов по выходным: день недели 0 (воскресенье) или 6 (суббота)
-- 3. ARRAY_LENGTH(product_ids, 1) - вычисляет количество товаров в каждом заказе
-- 4. AVG() - рассчитывает среднее количество товаров по всем отфильтрованным заказам
-- 5. ROUND(..., 2) - округляет результат до двух знаков после запятой

-- Пример результата:
-- avg_order_size
-- 4.75